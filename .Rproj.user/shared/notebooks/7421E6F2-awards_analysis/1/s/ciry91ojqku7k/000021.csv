"0","dat_table_all <- dat_joined %>% 
  #get hit rate of awards between 2002 and 2015. earlier years skew the data since enterNFL not as available
  filter(award_year >= 2002,
         award_year <= 2015) %>% 
  group_by(award_name) %>% 
  mutate(total_count = n()) %>% 
  group_by(award_name, enterNFL) %>% 
  mutate(miss_count = ifelse(enterNFL == ""no"", n(), 0),
         hit_count = ifelse(enterNFL == ""yes"", n(), 0),
         hitrate_total = hit_count/total_count) %>% 
  ungroup() %>% 
  #fill in hitrate_total of misses (0) with the hitrate
  group_by(award_name) %>% 
  arrange(award_name, desc(hitrate_total)) %>% 
  mutate(hitrate_total = hitrate_total[1]) %>% 
  ungroup() %>% 
  #get list of awards between 2002 and 2015 and their hit rates
  select(award_name, total_count, hitrate_total) %>% 
  distinct() %>% 
  
  #add awardees 
  left_join(dat_joined, by = c(""award_name"", ""award_name"")) %>% 
  select(award_name, total_count, hitrate_total, award_year, name, enterNFL) %>% 
  #paste whether they entered the NFL
  mutate(name = paste(name, enterNFL, sep = ""_"")) %>% 
  select(-enterNFL) %>% 
  #scope on 2007
  filter(award_year >= 2007) %>% 
  
  #spread out year columns
  group_by(award_name, award_year) %>% 
  mutate(grouped_id = row_number()) %>% #add an index for spread
  pivot_wider(names_from = award_year, values_from = name) %>% 
  select(-grouped_id) %>% 
  arrange(desc(hitrate_total), desc(total_count)) %>% 
  ungroup() %>% 
  
  # collapse rows. function in functions.R
  mutate(award_count_rate = paste(award_name, total_count, hitrate_total, sep = ""~"")) %>% #new column to collapse on
  select(award_count_rate, everything(), -award_name, -total_count, -hitrate_total) %>%
  group_by(award_count_rate) %>%
  collapse_rows_df(award_count_rate) %>%
  separate(award_count_rate, into = c(""award_name"", ""total_count"", ""hitrate_total""), sep = ""~"") %>%
  ungroup() %>%
  
  #separate out whether they entered the nfl
  separate(""2007"", into = c(""2007"", ""2007_nfl""), sep=""_(?=[^_]+$)"") %>% 
  separate(""2008"", into = c(""2008"", ""2008_nfl""), sep=""_(?=[^_]+$)"") %>% 
  separate(""2009"", into = c(""2009"", ""2009_nfl""), sep=""_(?=[^_]+$)"") %>% 
  separate(""2010"", into = c(""2010"", ""2010_nfl""), sep=""_(?=[^_]+$)"") %>% 
  separate(""2011"", into = c(""2011"", ""2011_nfl""), sep=""_(?=[^_]+$)"") %>% 
  separate(""2012"", into = c(""2012"", ""2012_nfl""), sep=""_(?=[^_]+$)"") %>% 
  separate(""2013"", into = c(""2013"", ""2013_nfl""), sep=""_(?=[^_]+$)"") %>% 
  separate(""2014"", into = c(""2014"", ""2014_nfl""), sep=""_(?=[^_]+$)"") %>% 
  separate(""2015"", into = c(""2015"", ""2015_nfl""), sep=""_(?=[^_]+$)"") %>% 
  separate(""2016"", into = c(""2016"", ""2016_nfl""), sep=""_(?=[^_]+$)"") %>% 
  separate(""2017"", into = c(""2017"", ""2017_nfl""), sep=""_(?=[^_]+$)"") %>% 
  separate(""2018"", into = c(""2018"", ""2018_nfl""), sep=""_(?=[^_]+$)"") %>% 
  # separate out scope
  separate(award_name, into = c(""Name of Award"", ""Scope""), sep=""_(?=[^_]+$)"") %>% 
 
  # replace all NAs with blank
  replace(., is.na(.), """") %>% 
  # add id
  mutate(row = row_number()) %>% 
  select(row, everything()) %>%   
  # reformat 
  mutate(hitrate_total = formattable::percent(hitrate_total, format = ""d"", digits = 0)) %>% 
  select(row:hitrate_total, `2007`, `2008`, `2009`, `2010`, `2011`, `2012`, `2013`, `2014`, `2015`, 
         `2016`, `2017`, `2018`, everything()) %>% 
  rename('Total Number of Awards' = total_count,
         '% Entered NFL' = hitrate_total) 
"
"2","Expected 3 pieces. Missing pieces filled with `NA` in 47 rows [2, 13, 20, 22, 38, 43, 54, 55, 58, 66, 68, 70, 75, 77, 87, 91, 106, 108, 110, 114, ...]."
"2","Expected 2 pieces. Missing pieces filled with `NA` in 47 rows [2, 13, 20, 22, 38, 43, 54, 55, 58, 66, 68, 70, 75, 77, 87, 91, 106, 108, 110, 114, ...]."
